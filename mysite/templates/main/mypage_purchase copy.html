{% extends 'base.html' %}
{% load static %}
{% block content %}

<!--purchase start -->
<section id="mypage" class="purchase">
    <div class="container">
        <div class="title">마이페이지</div>
    </div>
    <div id="mypage_body">
        <div class="select_menu_box">
            <div class="list-group">
                <a href="#" class="list-group-item active">개인정보</a>
                <a href="#" class="list-group-item">구매내역</a>
                <a href="#" class="list-group-item">구독정보</a>
                <a href="#" class="list-group-item">탈퇴하기</a>
            </div>
        </div>
        <div class="content" id="private_info">
            <div class="title">구매내역</div>
            <div class="private_info_item" style="border: 1px solid black;">
                <img src="">
                <span>콜롬비아 디카페인</span>
                <div>
                    <span>142,200</span>
                    <div></div>
                    <button onclick="toggleReviewForm(this)">리뷰쓰기</button>
                    <div class="reviewbox" style="display: none;">
                        <h2>소중한 의견</h2>

                        <!-- 리뷰를 입력하는 폼 -->
                        <form id="reviewForm" action="/submit_review" method="post">
                            <!-- 별점 선택을 위한 별 아이콘들 -->
                            <div class="star_rating">
                                <span class="star" value="1"></span>
                                <span class="star" value="2"></span>
                                <span class="star" value="3"></span>
                                <span class="star" value="4"></span>
                                <span class="star" value="5"></span>
                                <!-- Hidden input으로 선택된 별점 값을 저장 -->
                                <input type="hidden" name="starRating" id="starRatingInput" value="" />
                            </div>
                            <textarea class="star_box" name="reviewContent" placeholder="리뷰 내용을 작성해주세요."></textarea>
                            <input type="submit" class="btn02" value="리뷰 등록"/>
                        </form>
                        <div></div>
                    </div>
                </div>
            </div>
            <div class="private_info_item" style="border: 1px solid black;">
                <!-- 다른 상품들에 대한 정보 -->
            </div>
            <!-- 추가적인 구매내역 아이템들 -->
        </div>
    </div>
</section><!--/.mypage-->
<!--purchase end -->

<script>
    // 리뷰 폼 보이기/숨기기 함수
    function toggleReviewForm(button) {
        $(button).siblings('.reviewbox').toggle();
    }
    
    // 별점 선택 및 리뷰 제출
    $(document).ready(function() {
        // 별점 선택 시 동작
        $('.star_rating > .star').click(function() {
            $(this).parent().children('span').removeClass('on');
            $(this).addClass('on').prevAll('span').addClass('on');

            var starValue = $(this).attr('value');
            $('#starRatingInput').val(starValue);
        });

        // 리뷰 폼 제출 시 동작
        $('#reviewForm').submit(function(e) {
            e.preventDefault(); // 기본 폼 제출 동작 막기 (테스트용)

            var formData = $(this).serialize();
            console.log(formData); // 서버에 데이터 전송 (테스트용)

            // 실제로는 여기서 AJAX를 사용하여 서버에 데이터를 전송할 수 있습니다.
            // 예를 들어:
            /*
            $.ajax({
                type: "POST",
                url: $(this).attr('action'),
                data: formData,
                success: function(response) {
                    // 서버 응답 처리
                },
                error: function(error) {
                    // 오류 처리
                }
            });
            */
        });
    });
</script>

{% endblock %}
